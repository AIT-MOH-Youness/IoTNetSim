import React from 'react';
import CardDataStats from '../../components/CardDataStats';
import TableOne from '../../components/Tables/TableOne';



const user = localStorage.getItem('user');


const userData = localStorage.getItem('user')
  ? JSON.parse(localStorage.getItem('user')!)
  : null;

const fetchApisWithFetch = async () => {
  try {
    const [usersResponse, devicesResponse, protocolsResponse,sessionsResponse] =
      await Promise.all([
        fetch('http://localhost:8080/api/users'),
        fetch('http://localhost:8080/api/devices'),
        fetch('http://localhost:8080/api/protocols'),
        fetch('http://localhost:8080/api/auth/actualuser'),
      ]);

    if (!usersResponse.ok || !devicesResponse.ok || !protocolsResponse.ok) {
      throw new Error('Failed to fetch one or more resources.');
    }

    const users = await usersResponse.json();
    const devices = await devicesResponse.json();
    const protocols = await protocolsResponse.json();
    const actualUser = await sessionsResponse.json();
    
    return {
      users,
      devices,
      protocols,
      actualUser,
    };
  } catch (error) {
    console.error('Error fetching APIs using fetch:', error);
    throw error;
  }
};

let usersSize = 0;
let devicesSize = 0;
let protocolsSize = 0;
let sessions = 0;


const logSizes = async () => {
  try {
    const { users, devices, protocols,actualUser } = await fetchApisWithFetch();

    usersSize = users.length;
    devicesSize = devices.length;
    protocolsSize =  protocols.length;
    sessions = actualUser.id;
  } catch (error) {
    console.error('Error fetching sizes of tables:', error);
  }
};

logSizes();



const About: React.FC = () => {
  return (
    <>
    {(userData.email === "admin@admin.com") ? (
        <>
          <div className="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6 xl:grid-cols-4 2xl:gap-7.5">
            <CardDataStats
              title="Total sessions crÃ©es par les utilisateurs"
              total={`${sessions}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="16"
                viewBox="0 0 22 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11 15.1156C4.19376 15.1156 0.825012 8.61876 0.687512 8.34376C0.584387 8.13751 0.584387 7.86251 0.687512 7.65626C0.825012 7.38126 4.19376 0.918762 11 0.918762C17.8063 0.918762 21.175 7.38126 21.3125 7.65626C21.4156 7.86251 21.4156 8.13751 21.3125 8.34376C21.175 8.61876 17.8063 15.1156 11 15.1156ZM2.26876 8.00001C3.02501 9.27189 5.98126 13.5688 11 13.5688C16.0188 13.5688 18.975 9.27189 19.7313 8.00001C18.975 6.72814 16.0188 2.43126 11 2.43126C5.98126 2.43126 3.02501 6.72814 2.26876 8.00001Z"
                  fill=""
                />
                <path
                  d="M11 10.9219C9.38438 10.9219 8.07812 9.61562 8.07812 8C8.07812 6.38438 9.38438 5.07812 11 5.07812C12.6156 5.07812 13.9219 6.38438 13.9219 8C13.9219 9.61562 12.6156 10.9219 11 10.9219ZM11 6.625C10.2437 6.625 9.625 7.24375 9.625 8C9.625 8.75625 10.2437 9.375 11 9.375C11.7563 9.375 12.375 8.75625 12.375 8C12.375 7.24375 11.7563 6.625 11 6.625Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre du protocoles"
              total={`${protocolsSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11 17C13.2091 17 15 15.2091 15 13C15 10.7909 13.2091 9 11 9C8.79086 9 7 10.7909 7 13C7 15.2091 8.79086 17 11 17ZM11 11C11.5523 11 12 11.4477 12 12C12 12.5523 11.5523 13 11 13C10.4477 13 10 12.5523 10 12C10 11.4477 10.4477 11 11 11Z"
                  fill=""
                />
                <path
                  d="M19.3633 6.63604C17.9322 5.2049 15.2333 4.5 12.5 4.5C9.7667 4.5 7.06779 5.2049 5.63668 6.63604C4.20556 8.06718 3.5 10.0855 3.5 12C3.5 13.9145 4.20556 15.9328 5.63668 17.3639C7.06779 18.7951 9.7667 19.5 12.5 19.5C15.2333 19.5 17.9322 18.7951 19.3633 17.3639C20.7944 15.9328 21.5 13.9145 21.5 12C21.5 10.0855 20.7944 8.06718 19.3633 6.63604ZM12.5 18.5C10.0147 18.5 7.73046 17.3507 6.364 15.636C6.62412 14.8474 7.11491 14.2289 7.73604 13.8636C8.35717 13.4983 9.10991 13.3874 9.76947 13.5778C10.4202 13.7579 11.0494 14.0567 11.5 14.5C11.9506 14.9433 12.5798 15.2421 13.2305 15.4222C13.8901 15.6126 14.6428 15.7235 15.263 15.0887C15.8841 14.4236 16.3749 13.8052 16.635 13.017C18.0697 13.5093 19.0784 14.6457 19.4336 15.9237C18.0502 16.4419 15.9734 17.0274 12.5 17.0274C9.0266 17.0274 6.02946 16.4066 4.59612 14.9417C4.93649 13.4937 6.4552 12.5 8.086 12.5C9.71681 12.5 10.9045 13.278 11.2204 13.8716C11.5362 14.4654 12.2338 14.6517 12.8665 14.336C13.467 14.0621 13.7598 13.4876 13.7598 12.8467C13.7598 12.2059 13.467 11.6314 12.8665 11.3575C12.2338 11.0428 11.5362 11.229 11.2204 11.822C10.9045 12.4159 9.71681 13.194 8.086 13.194C6.4552 13.194 4.93649 12.2003 4.59612 10.7523C6.02946 9.28739 9.0266 8.66661 12.5 8.66661C15.9734 8.66661 18.0502 9.25206 19.4336 9.74032C19.0784 10.9583 18.0697 12.0947 16.635 12.587C16.3749 12.8048 15.8841 13.2342 15.263 13.5932C14.6428 13.8045 13.8901 13.9154 13.2305 14.1056C12.5798 14.2857 11.9506 14.5845 11.5 15.0287C11.0494 15.4729 10.4202 15.7717 9.76947 15.9518C9.10991 16.1422 8.35717 16.0313 7.73604 15.666C7.11491 15.3007 6.62412 14.6822 6.364 13.8936C7.73046 12.1799 10.0147 11.0306 12.5 11.0306C14.9853 11.0306 17.2695 12.1799 18.635 13.8936C18.2946 14.6822 17.8048 15.3007 17.1837 15.666C16.5631 16.0313 15.8104 16.1422 15.1499 15.9518C14.4991 15.7717 13.8709 15.4729 13.4193 15.0287C12.9687 14.5845 12.3395 14.2857 11.6888 14.1056C11.0292 13.9154 10.2765 13.8048 9.74392 13.5932C9.12283 13.2342 8.632 12.8048 8.38188 12.587C6.94844 12.0947 5.93974 10.9583 5.58458 9.74032C6.938 9.25206 9.01568 8.66661 12.5 8.66661C15.9734 8.66661 18.0502 9.25206 19.4336 9.74032C19.0784 10.9583 18.0697 12.0947 16.635 12.587C16.3749 12.8048 15.8841 13.2342 15.263 13.5932C14.6428 13.8045 13.8901 13.9154 13.2305 14.1056C12.5798 14.2857 11.9506 14.5845 11.5 15.0287C11.0494 15.4729 10.4202 15.7717 9.76947 15.9518C9.10991 16.1422 8.35717 16.0313 7.73604 15.666C7.11491 15.3007 6.62412 14.6822 6.364 13.8936C7.73046 12.1799 10.0147 11.0306 12.5 11.0306C14.9853 11.0306 17.2695 12.1799 18.635 13.8936Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre des devices"
              total={`${devicesSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16 1C14.895 1 14 1.895 14 3V4H8V3C8 1.895 7.105 1 6 1C4.895 1 4 1.895 4 3V17C4 18.105 4.895 19 6 19C7.105 19 8 18.105 8 17V15H14V17C14 18.105 14.895 19 16 19C17.105 19 18 18.105 18 17V3C18 1.895 17.105 1 16 1ZM6 3C5.447 3 5 3.447 5 4V15H7V4C7 3.447 6.553 3 6 3ZM16 15V4C16 3.447 15.553 3 15 3C14.447 3 14 3.447 14 4V15H16ZM7 5H15V14H7V5Z"
                  fill=""
                />
                <circle cx="11" cy="10" r="2" fill="" />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre d'utilisateurs"
              total={`${usersSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="18"
                viewBox="0 0 22 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.18418 8.03751C9.31543 8.03751 11.0686 6.35313 11.0686 4.25626C11.0686 2.15938 9.31543 0.475006 7.18418 0.475006C5.05293 0.475006 3.2998 2.15938 3.2998 4.25626C3.2998 6.35313 5.05293 8.03751 7.18418 8.03751ZM7.18418 2.05626C8.45605 2.05626 9.52168 3.05313 9.52168 4.29063C9.52168 5.52813 8.49043 6.52501 7.18418 6.52501C5.87793 6.52501 4.84668 5.52813 4.84668 4.29063C4.84668 3.05313 5.9123 2.05626 7.18418 2.05626Z"
                  fill=""
                />
                <path
                  d="M15.8124 9.6875C17.6687 9.6875 19.1468 8.24375 19.1468 6.42188C19.1468 4.6 17.6343 3.15625 15.8124 3.15625C13.9905 3.15625 12.478 4.6 12.478 6.42188C12.478 8.24375 13.9905 9.6875 15.8124 9.6875ZM15.8124 4.7375C16.8093 4.7375 17.5999 5.49375 17.5999 6.45625C17.5999 7.41875 16.8093 8.175 15.8124 8.175C14.8155 8.175 14.0249 7.41875 14.0249 6.45625C14.0249 5.49375 14.8155 4.7375 15.8124 4.7375Z"
                  fill=""
                />
                <path
                  d="M15.9843 10.0313H15.6749C14.6437 10.0313 13.6468 10.3406 12.7874 10.8563C11.8593 9.61876 10.3812 8.79376 8.73115 8.79376H5.67178C2.85303 8.82814 0.618652 11.0625 0.618652 13.8469V16.3219C0.618652 16.975 1.13428 17.4906 1.7874 17.4906H20.2468C20.8999 17.4906 21.4499 16.9406 21.4499 16.2875V15.4625C21.4155 12.4719 18.9749 10.0313 15.9843 10.0313ZM2.16553 15.9438V13.8469C2.16553 11.9219 3.74678 10.3406 5.67178 10.3406H8.73115C10.6562 10.3406 12.2374 11.9219 12.2374 13.8469V15.9438H2.16553V15.9438ZM19.8687 15.9438H13.7499V13.8469C13.7499 13.2969 13.6468 12.7469 13.4749 12.2313C14.0937 11.7844 14.8499 11.5781 15.6405 11.5781H15.9499C18.0812 11.5781 19.8343 13.3313 19.8343 15.4625V15.9438H19.8687Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
          </div>

          <div className="mt-4 grid grid-cols-12 gap-4 md:mt-6 md:gap-6 2xl:mt-7.5 2xl:gap-7.5"></div>
          <TableOne />
        </>



      ) : (


        <>
          <div className="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6 xl:grid-cols-4 2xl:gap-7.5">
            <CardDataStats
              title="Total sessions crÃ©es par les utilisateurs"
              total={`${sessions}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="16"
                viewBox="0 0 22 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11 15.1156C4.19376 15.1156 0.825012 8.61876 0.687512 8.34376C0.584387 8.13751 0.584387 7.86251 0.687512 7.65626C0.825012 7.38126 4.19376 0.918762 11 0.918762C17.8063 0.918762 21.175 7.38126 21.3125 7.65626C21.4156 7.86251 21.4156 8.13751 21.3125 8.34376C21.175 8.61876 17.8063 15.1156 11 15.1156ZM2.26876 8.00001C3.02501 9.27189 5.98126 13.5688 11 13.5688C16.0188 13.5688 18.975 9.27189 19.7313 8.00001C18.975 6.72814 16.0188 2.43126 11 2.43126C5.98126 2.43126 3.02501 6.72814 2.26876 8.00001Z"
                  fill=""
                />
                <path
                  d="M11 10.9219C9.38438 10.9219 8.07812 9.61562 8.07812 8C8.07812 6.38438 9.38438 5.07812 11 5.07812C12.6156 5.07812 13.9219 6.38438 13.9219 8C13.9219 9.61562 12.6156 10.9219 11 10.9219ZM11 6.625C10.2437 6.625 9.625 7.24375 9.625 8C9.625 8.75625 10.2437 9.375 11 9.375C11.7563 9.375 12.375 8.75625 12.375 8C12.375 7.24375 11.7563 6.625 11 6.625Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre du protocoles"
              total={`${protocolsSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11 17C13.2091 17 15 15.2091 15 13C15 10.7909 13.2091 9 11 9C8.79086 9 7 10.7909 7 13C7 15.2091 8.79086 17 11 17ZM11 11C11.5523 11 12 11.4477 12 12C12 12.5523 11.5523 13 11 13C10.4477 13 10 12.5523 10 12C10 11.4477 10.4477 11 11 11Z"
                  fill=""
                />
                <path
                  d="M19.3633 6.63604C17.9322 5.2049 15.2333 4.5 12.5 4.5C9.7667 4.5 7.06779 5.2049 5.63668 6.63604C4.20556 8.06718 3.5 10.0855 3.5 12C3.5 13.9145 4.20556 15.9328 5.63668 17.3639C7.06779 18.7951 9.7667 19.5 12.5 19.5C15.2333 19.5 17.9322 18.7951 19.3633 17.3639C20.7944 15.9328 21.5 13.9145 21.5 12C21.5 10.0855 20.7944 8.06718 19.3633 6.63604ZM12.5 18.5C10.0147 18.5 7.73046 17.3507 6.364 15.636C6.62412 14.8474 7.11491 14.2289 7.73604 13.8636C8.35717 13.4983 9.10991 13.3874 9.76947 13.5778C10.4202 13.7579 11.0494 14.0567 11.5 14.5C11.9506 14.9433 12.5798 15.2421 13.2305 15.4222C13.8901 15.6126 14.6428 15.7235 15.263 15.0887C15.8841 14.4236 16.3749 13.8052 16.635 13.017C18.0697 13.5093 19.0784 14.6457 19.4336 15.9237C18.0502 16.4419 15.9734 17.0274 12.5 17.0274C9.0266 17.0274 6.02946 16.4066 4.59612 14.9417C4.93649 13.4937 6.4552 12.5 8.086 12.5C9.71681 12.5 10.9045 13.278 11.2204 13.8716C11.5362 14.4654 12.2338 14.6517 12.8665 14.336C13.467 14.0621 13.7598 13.4876 13.7598 12.8467C13.7598 12.2059 13.467 11.6314 12.8665 11.3575C12.2338 11.0428 11.5362 11.229 11.2204 11.822C10.9045 12.4159 9.71681 13.194 8.086 13.194C6.4552 13.194 4.93649 12.2003 4.59612 10.7523C6.02946 9.28739 9.0266 8.66661 12.5 8.66661C15.9734 8.66661 18.0502 9.25206 19.4336 9.74032C19.0784 10.9583 18.0697 12.0947 16.635 12.587C16.3749 12.8048 15.8841 13.2342 15.263 13.5932C14.6428 13.8045 13.8901 13.9154 13.2305 14.1056C12.5798 14.2857 11.9506 14.5845 11.5 15.0287C11.0494 15.4729 10.4202 15.7717 9.76947 15.9518C9.10991 16.1422 8.35717 16.0313 7.73604 15.666C7.11491 15.3007 6.62412 14.6822 6.364 13.8936C7.73046 12.1799 10.0147 11.0306 12.5 11.0306C14.9853 11.0306 17.2695 12.1799 18.635 13.8936C18.2946 14.6822 17.8048 15.3007 17.1837 15.666C16.5631 16.0313 15.8104 16.1422 15.1499 15.9518C14.4991 15.7717 13.8709 15.4729 13.4193 15.0287C12.9687 14.5845 12.3395 14.2857 11.6888 14.1056C11.0292 13.9154 10.2765 13.8048 9.74392 13.5932C9.12283 13.2342 8.632 12.8048 8.38188 12.587C6.94844 12.0947 5.93974 10.9583 5.58458 9.74032C6.938 9.25206 9.01568 8.66661 12.5 8.66661C15.9734 8.66661 18.0502 9.25206 19.4336 9.74032C19.0784 10.9583 18.0697 12.0947 16.635 12.587C16.3749 12.8048 15.8841 13.2342 15.263 13.5932C14.6428 13.8045 13.8901 13.9154 13.2305 14.1056C12.5798 14.2857 11.9506 14.5845 11.5 15.0287C11.0494 15.4729 10.4202 15.7717 9.76947 15.9518C9.10991 16.1422 8.35717 16.0313 7.73604 15.666C7.11491 15.3007 6.62412 14.6822 6.364 13.8936C7.73046 12.1799 10.0147 11.0306 12.5 11.0306C14.9853 11.0306 17.2695 12.1799 18.635 13.8936Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre des devices"
              total={`${devicesSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="22"
                viewBox="0 0 22 22"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16 1C14.895 1 14 1.895 14 3V4H8V3C8 1.895 7.105 1 6 1C4.895 1 4 1.895 4 3V17C4 18.105 4.895 19 6 19C7.105 19 8 18.105 8 17V15H14V17C14 18.105 14.895 19 16 19C17.105 19 18 18.105 18 17V3C18 1.895 17.105 1 16 1ZM6 3C5.447 3 5 3.447 5 4V15H7V4C7 3.447 6.553 3 6 3ZM16 15V4C16 3.447 15.553 3 15 3C14.447 3 14 3.447 14 4V15H16ZM7 5H15V14H7V5Z"
                  fill=""
                />
                <circle cx="11" cy="10" r="2" fill="" />
              </svg>
            </CardDataStats>
            <CardDataStats
              title="Total nombre d'utilisateurs"
              total={`${usersSize}`}
            >
              <svg
                className="fill-primary dark:fill-white"
                width="22"
                height="18"
                viewBox="0 0 22 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M7.18418 8.03751C9.31543 8.03751 11.0686 6.35313 11.0686 4.25626C11.0686 2.15938 9.31543 0.475006 7.18418 0.475006C5.05293 0.475006 3.2998 2.15938 3.2998 4.25626C3.2998 6.35313 5.05293 8.03751 7.18418 8.03751ZM7.18418 2.05626C8.45605 2.05626 9.52168 3.05313 9.52168 4.29063C9.52168 5.52813 8.49043 6.52501 7.18418 6.52501C5.87793 6.52501 4.84668 5.52813 4.84668 4.29063C4.84668 3.05313 5.9123 2.05626 7.18418 2.05626Z"
                  fill=""
                />
                <path
                  d="M15.8124 9.6875C17.6687 9.6875 19.1468 8.24375 19.1468 6.42188C19.1468 4.6 17.6343 3.15625 15.8124 3.15625C13.9905 3.15625 12.478 4.6 12.478 6.42188C12.478 8.24375 13.9905 9.6875 15.8124 9.6875ZM15.8124 4.7375C16.8093 4.7375 17.5999 5.49375 17.5999 6.45625C17.5999 7.41875 16.8093 8.175 15.8124 8.175C14.8155 8.175 14.0249 7.41875 14.0249 6.45625C14.0249 5.49375 14.8155 4.7375 15.8124 4.7375Z"
                  fill=""
                />
                <path
                  d="M15.9843 10.0313H15.6749C14.6437 10.0313 13.6468 10.3406 12.7874 10.8563C11.8593 9.61876 10.3812 8.79376 8.73115 8.79376H5.67178C2.85303 8.82814 0.618652 11.0625 0.618652 13.8469V16.3219C0.618652 16.975 1.13428 17.4906 1.7874 17.4906H20.2468C20.8999 17.4906 21.4499 16.9406 21.4499 16.2875V15.4625C21.4155 12.4719 18.9749 10.0313 15.9843 10.0313ZM2.16553 15.9438V13.8469C2.16553 11.9219 3.74678 10.3406 5.67178 10.3406H8.73115C10.6562 10.3406 12.2374 11.9219 12.2374 13.8469V15.9438H2.16553V15.9438ZM19.8687 15.9438H13.7499V13.8469C13.7499 13.2969 13.6468 12.7469 13.4749 12.2313C14.0937 11.7844 14.8499 11.5781 15.6405 11.5781H15.9499C18.0812 11.5781 19.8343 13.3313 19.8343 15.4625V15.9438H19.8687Z"
                  fill=""
                />
              </svg>
            </CardDataStats>
          </div>

        </>


      )}

    </>
  );
};

export default About;
